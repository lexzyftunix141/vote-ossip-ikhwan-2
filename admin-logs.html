<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin OSSIP - Log Aktivitas</title>
    <link rel="icon" type="image/png" href="assets/ossip-bg.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* ===== RESET & BASE STYLES ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #1a237e;
            --secondary-color: #3949ab;
            --success-color: #4CAF50;
            --warning-color: #FF9800;
            --danger-color: #F44336;
            --info-color: #2196F3;
            --light-color: #f5f5f5;
            --dark-color: #333;
            --gray-color: #666;
            --border-color: #e0e0e0;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: #f0f2f5;
            color: var(--dark-color);
            line-height: 1.6;
        }

        /* ===== ADMIN LAYOUT ===== */
        .admin-dashboard-container {
            display: flex;
            min-height: 100vh;
        }

        /* ===== SIDEBAR ===== */
        .admin-sidebar {
            width: 280px;
            background: linear-gradient(180deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 25px 20px;
            box-shadow: 2px 0 15px rgba(0,0,0,0.1);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }

        .admin-profile {
            text-align: center;
            padding: 20px 0;
            border-bottom: 1px solid rgba(255,255,255,0.2);
            margin-bottom: 20px;
        }

        .profile-avatar {
            width: 80px;
            height: 80px;
            background: rgba(255,255,255,0.15);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            margin: 0 auto 15px;
            color: white;
            border: 3px solid rgba(255,255,255,0.2);
        }

        .admin-profile h3 {
            font-size: 18px;
            margin: 10px 0 5px;
            font-weight: 600;
        }

        .admin-role {
            font-size: 14px;
            opacity: 0.9;
            margin: 0 0 5px;
            color: rgba(255,255,255,0.9);
        }

        .admin-username {
            font-size: 13px;
            opacity: 0.7;
            color: rgba(255,255,255,0.7);
        }

        .admin-menu ul {
            list-style: none;
            padding: 15px 0;
        }

        .admin-menu li {
            margin-bottom: 5px;
        }

        .admin-menu a {
            display: flex;
            align-items: center;
            padding: 12px 18px;
            color: rgba(255,255,255,0.85);
            text-decoration: none;
            border-radius: 10px;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .admin-menu a:hover {
            background: rgba(255,255,255,0.15);
            color: white;
            transform: translateX(5px);
        }

        .admin-menu li.active a {
            background: rgba(255,255,255,0.2);
            color: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .admin-menu i {
            width: 25px;
            margin-right: 12px;
            font-size: 16px;
        }

        .logout-section {
            margin-top: auto;
            padding-top: 20px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        /* ===== BUTTONS ===== */
        .btn-primary, .btn-secondary, .btn-filter, .btn-refresh {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
            font-size: 14px;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: #151d6b;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(26, 35, 126, 0.2);
        }

        .btn-secondary {
            background: white;
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
        }

        .btn-secondary:hover {
            background: var(--primary-color);
            color: white;
            transform: translateY(-2px);
        }

        .btn-filter {
            background: var(--info-color);
            color: white;
        }

        .btn-filter:hover {
            background: #0b7dda;
            transform: translateY(-2px);
        }

        .btn-refresh {
            background: var(--success-color);
            color: white;
        }

        .btn-refresh:hover {
            background: #388E3C;
            transform: translateY(-2px);
        }

        .btn-refresh.refreshing i {
            animation: spin 1s linear infinite;
        }

        /* ===== MAIN CONTENT ===== */
        .admin-main-content {
            flex: 1;
            margin-left: 280px;
            padding: 30px;
            min-height: 100vh;
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--border-color);
        }

        .page-header h1 {
            font-size: 28px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .ossip-badge {
            background: var(--success-color);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
        }

        .header-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        /* ===== BANNER ===== */
        .ossip-log-banner {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
            text-align: center;
            font-weight: 600;
            font-size: 18px;
            box-shadow: 0 4px 15px rgba(26, 35, 126, 0.15);
        }

        .ossip-log-banner i {
            margin-right: 10px;
            font-size: 20px;
        }

        /* ===== STATISTICS ===== */
        .log-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            text-align: center;
            border-top: 4px solid var(--info-color);
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card .icon {
            font-size: 32px;
            margin-bottom: 15px;
            color: var(--info-color);
        }

        .stat-card .value {
            font-size: 36px;
            font-weight: 700;
            color: var(--dark-color);
            margin: 10px 0;
        }

        .stat-card .label {
            color: var(--gray-color);
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* ===== FILTER SECTION ===== */
        .logs-filter-section {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            margin-bottom: 25px;
        }

        .filter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .form-group {
            position: relative;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--dark-color);
            font-weight: 500;
            font-size: 14px;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .log-search-box {
            position: relative;
        }

        .log-search-box i.fa-search {
            position: absolute;
            left: 15px;
            top: 40px;
            color: #999;
        }

        .log-search-box input {
            padding-left: 40px;
        }

        .date-range {
            display: flex;
            gap: 15px;
        }

        /* ===== LOGS TABLE ===== */
        .voters-table-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            overflow: hidden;
            margin-bottom: 30px;
        }

        .table-responsive {
            overflow-x: auto;
        }

        .logs-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 1000px;
        }

        .logs-table th {
            background: #f8f9fa;
            padding: 18px 15px;
            text-align: left;
            font-weight: 600;
            color: #495057;
            border-bottom: 3px solid var(--border-color);
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .logs-table td {
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
            vertical-align: middle;
        }

        .logs-table tr:hover {
            background-color: #f9f9f9;
        }

        /* Log Level Badges */
        .log-level {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            display: inline-block;
            min-width: 80px;
            text-align: center;
        }

        .level-info {
            background: #e3f2fd;
            color: var(--info-color);
        }

        .level-success {
            background: #e8f5e9;
            color: var(--success-color);
        }

        .level-warning {
            background: #fff3e0;
            color: var(--warning-color);
        }

        .level-error {
            background: #ffebee;
            color: var(--danger-color);
        }

        .level-security {
            background: #f3e5f5;
            color: #9c27b0;
        }

        /* User Info */
        .log-user {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--info-color), #64b5f6);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 16px;
        }

        .log-details {
            font-size: 12px;
            color: var(--gray-color);
            margin-top: 4px;
        }

        /* Message Column */
        .log-message {
            max-width: 300px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        /* IP Address */
        .log-ip {
            font-family: 'Courier New', monospace;
            font-size: 13px;
            color: var(--gray-color);
        }

        /* Actions */
        .log-actions {
            display: flex;
            gap: 8px;
        }

        .log-actions button {
            background: none;
            border: 2px solid var(--border-color);
            width: 36px;
            height: 36px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--gray-color);
            transition: all 0.3s;
        }

        .log-actions button:hover {
            background: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
            transform: scale(1.1);
        }

        /* ===== PAGINATION ===== */
        .pagination {
            margin-top: 30px;
            text-align: center;
        }

        .pagination ul {
            list-style: none;
            padding: 0;
            margin: 0;
            display: inline-flex;
            gap: 8px;
        }

        .page-item {
            margin: 0;
        }

        .page-link {
            display: block;
            padding: 10px 16px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            color: var(--primary-color);
            text-decoration: none;
            min-width: 45px;
            text-align: center;
            font-weight: 500;
            transition: all 0.3s;
        }

        .page-link:hover {
            background: var(--light-color);
            border-color: var(--primary-color);
        }

        .page-item.active .page-link {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .page-item.disabled .page-link {
            color: #ccc;
            cursor: not-allowed;
            border-color: #eee;
        }

        .page-item.disabled .page-link:hover {
            background: transparent;
            border-color: #eee;
        }

        /* ===== MODAL ===== */
        .log-detail-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: white;
            width: 100%;
            max-width: 700px;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            overflow: hidden;
            animation: slideUp 0.3s;
        }

        @keyframes slideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            padding: 25px 30px;
            background: var(--primary-color);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            margin: 0;
            font-size: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .close-modal {
            background: rgba(255,255,255,0.2);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            color: white;
            transition: background 0.3s;
        }

        .close-modal:hover {
            background: rgba(255,255,255,0.3);
        }

        .modal-body {
            padding: 30px;
            max-height: 70vh;
            overflow-y: auto;
        }

        .log-detail-content {
            display: grid;
            gap: 20px;
        }

        .detail-item {
            display: grid;
            grid-template-columns: 150px 1fr;
            align-items: start;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .detail-label {
            font-weight: 600;
            color: var(--dark-color);
            font-size: 14px;
        }

        .detail-value {
            word-break: break-word;
            color: var(--gray-color);
            font-size: 14px;
        }

        .modal-actions {
            margin-top: 25px;
            text-align: right;
        }

        /* ===== EMPTY STATE ===== */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--gray-color);
        }

        .empty-state i {
            font-size: 48px;
            margin-bottom: 20px;
            color: #ddd;
        }

        .empty-state h3 {
            font-size: 18px;
            margin-bottom: 10px;
            color: var(--dark-color);
        }

        .empty-state p {
            font-size: 14px;
            color: var(--gray-color);
        }

        /* ===== FOOTER ===== */
        .admin-footer {
            margin-top: 40px;
            padding-top: 25px;
            border-top: 2px solid var(--border-color);
            text-align: center;
            color: var(--gray-color);
            font-size: 13px;
        }

        .admin-footer p {
            margin: 8px 0;
        }

        /* ===== STATUS BAR ===== */
        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }

        .refresh-info {
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 14px;
            color: var(--gray-color);
        }

        .refresh-info i {
            color: var(--info-color);
        }

        .last-update-info {
            font-size: 13px;
            color: var(--gray-color);
            text-align: center;
            margin-top: 15px;
            margin-bottom: 20px;
        }

        /* ===== NOTIFICATION SYSTEM ===== */
        .notification-container {
            position: fixed;
            top: 30px;
            right: 30px;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            gap: 12px;
            max-width: 350px;
        }

        .notification {
            background: white;
            border-radius: 10px;
            padding: 18px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            gap: 15px;
            animation: slideInRight 0.3s ease;
            border-left: 4px solid var(--success-color);
            max-width: 350px;
        }

        .notification.info {
            border-left-color: var(--info-color);
        }

        .notification.warning {
            border-left-color: var(--warning-color);
        }

        .notification.error {
            border-left-color: var(--danger-color);
        }

        .notification.success {
            border-left-color: var(--success-color);
        }

        .notification-icon {
            font-size: 22px;
            flex-shrink: 0;
        }

        .notification-info {
            flex: 1;
            min-width: 0;
        }

        .notification-title {
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--dark-color);
            font-size: 14px;
        }

        .notification-message {
            font-size: 13px;
            color: var(--gray-color);
            line-height: 1.4;
        }

        .notification-close {
            background: none;
            border: none;
            color: #999;
            cursor: pointer;
            font-size: 16px;
            padding: 4px;
            flex-shrink: 0;
            transition: color 0.3s;
        }

        .notification-close:hover {
            color: var(--danger-color);
        }

        /* ===== ANIMATIONS ===== */
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes slideOutRight {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* ===== RESPONSIVE DESIGN ===== */
        @media (max-width: 1200px) {
            .admin-sidebar {
                width: 250px;
            }
            
            .admin-main-content {
                margin-left: 250px;
            }
        }

        @media (max-width: 992px) {
            .admin-dashboard-container {
                flex-direction: column;
            }
            
            .admin-sidebar {
                width: 100%;
                height: auto;
                position: relative;
                padding: 15px;
            }
            
            .admin-main-content {
                margin-left: 0;
                padding: 20px;
            }
            
            .admin-menu ul {
                display: flex;
                flex-wrap: wrap;
                gap: 10px;
            }
            
            .admin-menu li {
                flex: 1;
                min-width: 140px;
            }
            
            .filter-grid {
                grid-template-columns: 1fr;
            }
            
            .log-stats {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .page-header {
                flex-direction: column;
                gap: 15px;
                align-items: stretch;
            }
            
            .header-actions {
                flex-direction: column;
                gap: 10px;
            }
            
            .log-stats {
                grid-template-columns: 1fr;
            }
            
            .date-range {
                flex-direction: column;
                gap: 10px;
            }
            
            .detail-item {
                grid-template-columns: 1fr;
                gap: 5px;
            }
            
            .modal-content {
                width: 95%;
            }
        }

        @media (max-width: 576px) {
            .admin-sidebar {
                padding: 15px 10px;
            }
            
            .admin-menu li {
                min-width: auto;
            }
            
            .admin-menu a span {
                display: none;
            }
            
            .admin-menu i {
                margin-right: 0;
                width: auto;
            }
            
            .btn-primary, .btn-secondary, .btn-filter, .btn-refresh {
                width: 100%;
                justify-content: center;
            }
            
            .page-header h1 {
                font-size: 22px;
            }
            
            .pagination ul {
                flex-wrap: wrap;
                justify-content: center;
            }
        }

        /* ===== SCROLLBAR STYLING ===== */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
    </style>
</head>
<body>
    <!-- Notification Container -->
    <div class="notification-container" id="notificationContainer"></div>

    <div class="admin-dashboard-container">
        <!-- Sidebar -->
        <div class="admin-sidebar">
            <div class="admin-profile">
                <div class="profile-avatar">
                    <i class="fas fa-user-shield"></i>
                </div>
                <h3 id="adminName">Admin OSSIP</h3>
                <p class="admin-role" id="adminRole">Pengurus Organisasi</p>
                <p class="admin-username" id="adminUsername">@ossip_admin</p>
            </div>
            
            <nav class="admin-menu">
                <ul>
                    <li>
                        <a href="admin-dashboard.html">
                            <i class="fas fa-tachometer-alt"></i>
                            <span>Dashboard</span>
                        </a>
                    </li>
                    <li>
                        <a href="admin-voters.html">
                            <i class="fas fa-users"></i>
                            <span>Data Santri</span>
                        </a>
                    </li>
                    <li>
                        <a href="admin-statistics.html">
                            <i class="fas fa-chart-bar"></i>
                            <span>Statistik</span>
                        </a>
                    </li>
                    <li class="active">
                        <a href="admin-logs.html">
                            <i class="fas fa-history"></i>
                            <span>Log Aktivitas</span>
                        </a>
                    </li>
                    <li>
                        <a href="admin-settings.html">
                            <i class="fas fa-cog"></i>
                            <span>Pengaturan</span>
                        </a>
                    </li>
                </ul>
            </nav>
            
            <div class="logout-section">
                <button class="btn-primary" onclick="logout()" style="width: 100%;">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="admin-main-content">
            <!-- Page Header -->
            <div class="page-header">
                <h1><i class="fas fa-history"></i> Log Aktivitas Sistem OSSIP <span class="ossip-badge">Real-time</span></h1>
                <div class="header-actions">
                    <button class="btn-refresh" onclick="refreshLogs()" id="refreshBtn">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                    <button class="btn-secondary" onclick="clearOldLogs()">
                        <i class="fas fa-trash"></i> Hapus Log Lama
                    </button>
                    <button class="btn-primary" onclick="exportLogs()">
                        <i class="fas fa-download"></i> Ekspor Log
                    </button>
                </div>
            </div>

            <!-- Status Bar -->
            <div class="status-bar">
                <div class="refresh-info">
                    <div>
                        <i class="fas fa-clock"></i> Terakhir diperbarui: 
                        <span id="lastUpdateTime" style="font-weight: 600;">-</span>
                    </div>
                    <div>
                        <i class="fas fa-sync-alt"></i> Auto-refresh: 
                        <span id="refreshTimer" style="font-weight: 600;">10s</span>
                    </div>
                </div>
                <div style="font-size: 12px; color: var(--success-color); font-weight: 600;">
                    <i class="fas fa-circle"></i> Sistem Aktif
                </div>
            </div>

            <!-- OSSIP Banner -->
            <div class="ossip-log-banner">
                <i class="fas fa-mosque"></i> LOG SISTEM PEMILIHAN PENGURUS OSSIP 2026-2027
                <div style="font-size: 13px; margin-top: 8px; opacity: 0.9;">
                    <i class="fas fa-broadcast-tower"></i> Monitoring real-time â€¢ Auto-refresh setiap 10 detik
                </div>
            </div>

            <!-- Log Statistics -->
            <div class="log-stats" id="logStats">
                <div class="stat-card">
                    <div class="icon">
                        <i class="fas fa-spinner fa-spin"></i>
                    </div>
                    <div class="value">-</div>
                    <div class="label">Memuat...</div>
                </div>
            </div>

            <!-- Search and Filter -->
            <div class="logs-filter-section">
                <div class="filter-grid">
                    <div class="form-group log-search-box">
                        <label for="logSearch"><i class="fas fa-search"></i> Cari Log</label>
                        <i class="fas fa-search"></i>
                        <input type="text" id="logSearch" class="form-control" placeholder="Pesan, pengguna, atau IP..." oninput="filterLogs()">
                    </div>
                    <div class="form-group">
                        <label for="logLevel"><i class="fas fa-filter"></i> Level Log</label>
                        <select id="logLevel" class="form-control" onchange="filterLogs()">
                            <option value="">Semua Level</option>
                            <option value="info">Info</option>
                            <option value="warning">Warning</option>
                            <option value="error">Error</option>
                            <option value="success">Success</option>
                            <option value="security">Security</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="logUser"><i class="fas fa-user"></i> Pengguna</label>
                        <select id="logUser" class="form-control" onchange="filterLogs()">
                            <option value="">Semua Pengguna</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="logModule"><i class="fas fa-cube"></i> Modul</label>
                        <select id="logModule" class="form-control" onchange="filterLogs()">
                            <option value="">Semua Modul</option>
                            <option value="auth">Autentikasi</option>
                            <option value="voting">Pemilihan</option>
                            <option value="candidate">Calon Pengurus</option>
                            <option value="system">Sistem</option>
                            <option value="admin">Admin</option>
                        </select>
                    </div>
                </div>
                <div class="filter-grid" style="margin-top: 20px;">
                    <div class="form-group date-range">
                        <div style="flex: 1;">
                            <label for="startDate">Dari Tanggal</label>
                            <input type="date" id="startDate" class="form-control" onchange="filterLogs()">
                        </div>
                        <div style="flex: 1;">
                            <label for="endDate">Sampai Tanggal</label>
                            <input type="date" id="endDate" class="form-control" onchange="filterLogs()">
                        </div>
                    </div>
                    <div style="display: flex; align-items: flex-end; gap: 10px;">
                        <button class="btn-filter" onclick="filterLogs()">
                            <i class="fas fa-filter"></i> Terapkan Filter
                        </button>
                        <button class="btn-secondary" onclick="resetFilters()">
                            <i class="fas fa-redo"></i> Reset Filter
                        </button>
                    </div>
                </div>
            </div>

            <!-- Logs Table -->
            <div class="voters-table-container">
                <div class="table-responsive">
                    <table class="logs-table">
                        <thead>
                            <tr>
                                <th>Timestamp</th>
                                <th>Level</th>
                                <th>Pengguna</th>
                                <th>Pesan</th>
                                <th>Modul</th>
                                <th>IP Address</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="logsTableBody">
                            <tr>
                                <td colspan="7">
                                    <div class="empty-state">
                                        <i class="fas fa-spinner fa-spin"></i>
                                        <h3>Memuat log aktivitas...</h3>
                                        <p>Silakan tunggu sebentar</p>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Pagination -->
            <div class="pagination">
                <ul class="pagination" id="logsPagination"></ul>
            </div>

            <!-- Footer -->
            <div class="admin-footer">
                <p>&copy; 2024 Organisasi Siswa Santri (OSSIP). Hak Cipta Dilindungi.</p>
                <p><i class="fas fa-mosque"></i> Pondok Pesantren Tahfidz Insan Pratama 2</p>
            </div>
        </div>
    </div>

    <!-- Modal Detail Log -->
    <div id="logDetailModal" class="log-detail-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-info-circle"></i> Detail Log OSSIP</h3>
                <button class="close-modal" onclick="closeLogDetailModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="log-detail-content" id="logDetailContent"></div>
                <div class="modal-actions">
                    <button type="button" class="btn-secondary" onclick="closeLogDetailModal()">Tutup</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===== GLOBAL VARIABLES =====
        let allLogs = [];
        let filteredLogs = [];
        let currentPage = 1;
        const logsPerPage = 20;
        let autoRefreshInterval;
        let refreshTimer = 10;
        let refreshInterval;
        let isAutoRefreshEnabled = true;
        let lastUpdateTime = null;
        let newLogsCount = 0;
        let lastLogId = null;
        let isInitialLoad = true;
        let isRefreshing = false;

        // ===== INITIALIZATION =====
        document.addEventListener('DOMContentLoaded', initializePage);

        async function initializePage() {
            console.log('ðŸš€ Memulai Sistem Log Admin...');
            
            if (!checkSession()) return;
            
            showNotification('Memulai', 'Memuat sistem log aktivitas...', 'info');
            
            // Set default dates
            setDefaultDates();
            
            // Initialize database
            await initializeDatabase();
            
            // Load initial logs
            await refreshLogs();
            
            // Setup real-time features
            setupRealTimeFeatures();
            
            // Start refresh timer
            startRefreshTimer();
            
            console.log('âœ… Sistem Log Admin siap digunakan');
        }

        // ===== SESSION MANAGEMENT =====
        function checkSession() {
            const isLoggedIn = sessionStorage.getItem('adminLoggedIn');
            const adminUsername = sessionStorage.getItem('adminUsername');
            
            if (!isLoggedIn || !adminUsername) {
                alert('âš ï¸ Anda harus login sebagai admin terlebih dahulu!');
                window.location.href = 'admin-login.html';
                return false;
            }
            
            // Set admin info
            const adminName = sessionStorage.getItem('adminName') || 'Admin OSSIP';
            const adminRole = sessionStorage.getItem('adminRole') || 'Administrator';
            
            document.getElementById('adminName').textContent = adminName;
            document.getElementById('adminRole').textContent = adminRole;
            document.getElementById('adminUsername').textContent = '@' + adminUsername;
            
            return true;
        }

        function setDefaultDates() {
            const today = new Date();
            const lastWeek = new Date(today);
            lastWeek.setDate(lastWeek.getDate() - 7);
            
            document.getElementById('startDate').valueAsDate = lastWeek;
            document.getElementById('endDate').valueAsDate = today;
        }

        // ===== DATABASE INTEGRATION =====
        async function initializeDatabase() {
            console.log('ðŸ”Œ Menghubungkan ke database...');
            
            return new Promise((resolve) => {
                // Check if database.js is already loaded
                if (window.db && typeof window.db.getAllAuditLogs === 'function') {
                    console.log('âœ… Database tersedia');
                    showNotification('Database', 'Koneksi database berhasil', 'success');
                    resolve(true);
                    return;
                }
                
                // Try to load database.js dynamically
                const script = document.createElement('script');
                script.src = 'database.js';
                script.onload = () => {
                    console.log('âœ… Script database dimuat');
                    
                    setTimeout(() => {
                        if (window.db && typeof window.db.getAllAuditLogs === 'function') {
                            showNotification('Database', 'Koneksi database berhasil', 'success');
                            resolve(true);
                        } else {
                            console.warn('âš ï¸ Database tidak ditemukan');
                            createMockDatabase();
                            resolve(false);
                        }
                    }, 500);
                };
                
                script.onerror = () => {
                    console.error('âŒ Gagal memuat database.js');
                    createMockDatabase();
                    resolve(false);
                };
                
                document.head.appendChild(script);
            });
        }

        function createMockDatabase() {
            console.log('ðŸ”„ Membuat database simulasi...');
            
            window.db = {
                getAllAuditLogs: async function() {
                    // Generate sample data
                    const mockLogs = [
                        {
                            id: 'log_1',
                            timestamp: new Date().toISOString(),
                            action: 'ADMIN_LOGIN_SUCCESS',
                            user_id: 'admin',
                            user_name: 'Admin OSSIP',
                            details: 'Admin berhasil login ke sistem',
                            ip_address: '192.168.1.100'
                        },
                        {
                            id: 'log_2',
                            timestamp: new Date(Date.now() - 300000).toISOString(),
                            action: 'VOTE_CAST_SUCCESS',
                            user_id: 'santri001',
                            user_name: 'Ahmad Fauzi',
                            details: 'Melakukan voting untuk kandidat nomor 1',
                            ip_address: '192.168.1.101'
                        },
                        {
                            id: 'log_3',
                            timestamp: new Date(Date.now() - 600000).toISOString(),
                            action: 'DATA_EXPORTED',
                            user_id: 'admin',
                            user_name: 'Admin OSSIP',
                            details: 'Mengekspor data voting ke CSV',
                            ip_address: '192.168.1.100'
                        },
                        {
                            id: 'log_4',
                            timestamp: new Date(Date.now() - 900000).toISOString(),
                            action: 'SYSTEM_ERROR',
                            user_id: 'system',
                            user_name: 'System',
                            details: 'Koneksi database timeout',
                            ip_address: 'localhost'
                        },
                        {
                            id: 'log_5',
                            timestamp: new Date(Date.now() - 1200000).toISOString(),
                            action: 'VOTER_REGISTERED',
                            user_id: 'santri002',
                            user_name: 'Muhammad Ali',
                            details: 'Santri baru terdaftar',
                            ip_address: '192.168.1.102'
                        }
                    ];
                    
                    return mockLogs.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                },
                
                addAuditLog: async function(log) {
                    console.log('ðŸ“ Menambah log audit:', log);
                    return true;
                },
                
                deleteOldLogs: async function(days) {
                    console.log('ðŸ—‘ï¸ Menghapus log lama (lebih dari ' + days + ' hari)');
                    return { deletedCount: Math.floor(Math.random() * 10) + 1 };
                }
            };
            
            showNotification('Mode Demo', 'Menggunakan database simulasi', 'warning');
        }

        // ===== REAL-TIME FEATURES =====
        function setupRealTimeFeatures() {
            console.log('âš¡ Mengatur fitur real-time...');
            
            // Listen for events from other pages
            window.addEventListener('dashboardUpdate', handleDashboardUpdate);
            window.addEventListener('newVote', handleNewVote);
            window.addEventListener('adminAction', handleAdminAction);
            
            // Setup auto-refresh
            autoRefreshInterval = setInterval(async () => {
                if (isAutoRefreshEnabled && !isRefreshing) {
                    await checkForNewLogs();
                }
            }, 10000); // Check every 10 seconds
            
            console.log('âœ… Fitur real-time aktif');
        }

        function handleDashboardUpdate(event) {
            console.log('ðŸ“¡ Update dari dashboard:', event.detail);
            showNotification('Update Dashboard', 'Data dashboard diperbarui', 'info');
            refreshLogs();
        }

        function handleNewVote(event) {
            console.log('ðŸ—³ï¸ Voting baru:', event.detail);
            
            const voteData = event.detail;
            const log = {
                id: 'vote_' + Date.now(),
                timestamp: new Date().toISOString(),
                action: 'VOTE_CAST_SUCCESS',
                user_id: voteData.userId,
                user_name: voteData.userName,
                details: 'Melakukan voting untuk kandidat nomor ' + voteData.candidateNumber,
                ip_address: 'real-time'
            };
            
            addLogToDisplay(log, true);
            updateLogStats();
            showNotification('Voting Baru', voteData.userName + ' melakukan voting', 'success');
        }

        function handleAdminAction(event) {
            console.log('ðŸ‘¨â€ðŸ’¼ Aksi admin:', event.detail);
            
            const adminData = event.detail;
            const log = {
                id: 'admin_' + Date.now(),
                timestamp: new Date().toISOString(),
                action: adminData.action || 'ADMIN_ACTION',
                user_id: 'admin',
                user_name: adminData.user || 'Admin',
                details: adminData.message,
                ip_address: 'real-time'
            };
            
            addLogToDisplay(log, true);
            updateLogStats();
            showNotification('Aksi Admin', adminData.message, 'info');
        }

        // ===== REFRESH TIMER =====
        function startRefreshTimer() {
            refreshTimer = 10;
            updateRefreshTimer();
            
            if (refreshInterval) {
                clearInterval(refreshInterval);
            }
            
            refreshInterval = setInterval(() => {
                refreshTimer--;
                updateRefreshTimer();
                
                if (refreshTimer <= 0) {
                    refreshTimer = 10;
                    if (isAutoRefreshEnabled && !isRefreshing) {
                        checkForNewLogs();
                    }
                }
            }, 1000);
        }

        function updateRefreshTimer() {
            document.getElementById('refreshTimer').textContent = refreshTimer + 's';
        }

        // ===== LOG MANAGEMENT =====
        async function refreshLogs() {
            if (isRefreshing) return;
            
            try {
                isRefreshing = true;
                const refreshBtn = document.getElementById('refreshBtn');
                if (refreshBtn) {
                    refreshBtn.classList.add('refreshing');
                }
                
                console.log('ðŸ”„ Memuat ulang log...');
                
                if (!window.db || !window.db.getAllAuditLogs) {
                    throw new Error('Database tidak tersedia');
                }
                
                const logs = await window.db.getAllAuditLogs();
                
                // Sort by timestamp (newest first)
                logs.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                
                const previousCount = allLogs.length;
                allLogs = logs;
                
                // Update last update time
                lastUpdateTime = new Date();
                document.getElementById('lastUpdateTime').textContent = 
                    lastUpdateTime.toLocaleTimeString('id-ID', { 
                        hour: '2-digit', 
                        minute: '2-digit',
                        second: '2-digit'
                    });
                
                // Update user filter options
                updateUserFilterOptions(logs);
                
                // Update statistics
                updateLogStats();
                
                // Filter and render logs
                filterLogs();
                
                // Reset refresh timer
                refreshTimer = 10;
                updateRefreshTimer();
                
                // Show notification if new logs found
                if (!isInitialLoad && logs.length > previousCount) {
                    const newCount = logs.length - previousCount;
                    showNotification(
                        'Data Diperbarui',
                        `Memuat ${newCount} log baru`,
                        'success'
                    );
                }
                
                isInitialLoad = false;
                
                showNotification('Berhasil', 'Log berhasil dimuat ulang', 'success');
                
            } catch (error) {
                console.error('Error refreshing logs:', error);
                showNotification('Error', 'Gagal memuat log: ' + error.message, 'error');
                
                document.getElementById('logsTableBody').innerHTML = `
                    <tr>
                        <td colspan="7">
                            <div class="empty-state">
                                <i class="fas fa-exclamation-triangle"></i>
                                <h3>Gagal memuat log</h3>
                                <p>${error.message}</p>
                                <button onclick="refreshLogs()" class="btn-secondary" style="margin-top: 15px;">
                                    <i class="fas fa-redo"></i> Coba Lagi
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            } finally {
                isRefreshing = false;
                const refreshBtn = document.getElementById('refreshBtn');
                if (refreshBtn) {
                    refreshBtn.classList.remove('refreshing');
                }
            }
        }

        async function checkForNewLogs() {
            try {
                if (!window.db || !window.db.getAllAuditLogs) return;
                
                const currentLogs = await window.db.getAllAuditLogs();
                
                if (allLogs.length > 0 && currentLogs.length > allLogs.length) {
                    const newCount = currentLogs.length - allLogs.length;
                    newLogsCount += newCount;
                    
                    showNotification(
                        'Log Baru',
                        `Ada ${newCount} log aktivitas baru`,
                        'info'
                    );
                    
                    // Auto refresh jika ada log baru
                    await refreshLogs();
                }
                
            } catch (error) {
                console.error('Error checking for new logs:', error);
            }
        }

        function addLogToDisplay(log, prepend = false) {
            const date = new Date(log.timestamp);
            const timeString = date.toLocaleTimeString('id-ID');
            const dateString = date.toLocaleDateString('id-ID');
            
            // Determine log level
            let level = 'info';
            let levelClass = 'level-info';
            
            if (log.action.includes('ERROR')) {
                level = 'error';
                levelClass = 'level-error';
            } else if (log.action.includes('WARNING')) {
                level = 'warning';
                levelClass = 'level-warning';
            } else if (log.action.includes('SUCCESS') || log.action.includes('VOTE_CAST')) {
                level = 'success';
                levelClass = 'level-success';
            } else if (log.action.includes('LOGIN') || log.action.includes('SECURITY')) {
                level = 'security';
                levelClass = 'level-security';
            }
            
            const row = document.createElement('tr');
            row.style.animation = 'fadeIn 0.5s';
            
            row.innerHTML = `
                <td>
                    <div>${dateString}</div>
                    <div class="log-details">${timeString} ðŸ†•</div>
                </td>
                <td><span class="log-level ${levelClass}">${level}</span></td>
                <td>
                    <div class="log-user">
                        <div class="user-avatar">
                            ${log.user_name ? log.user_name.charAt(0).toUpperCase() : 'S'}
                        </div>
                        <div>
                            <div>${log.user_name || 'System'}</div>
                            <div class="log-details">${log.user_id || 'system'}</div>
                        </div>
                    </div>
                </td>
                <td class="log-message" title="${log.details || log.action}">${(log.details || log.action).substring(0, 100)}</td>
                <td><span class="log-level level-info">${getModuleFromAction(log.action)}</span></td>
                <td><span class="log-ip">${log.ip_address || 'localhost'}</span></td>
                <td>
                    <div class="log-actions">
                        <button onclick="viewLogDetail('${log.id}')" title="Lihat Detail">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button onclick="copyLog('${log.id}')" title="Salin Log">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                </td>
            `;
            
            const tableBody = document.getElementById('logsTableBody');
            if (prepend && tableBody.firstChild) {
                tableBody.insertBefore(row, tableBody.firstChild);
            } else {
                tableBody.appendChild(row);
            }
            
            if (!allLogs.some(existingLog => existingLog.id === log.id)) {
                allLogs.unshift(log);
                updateLogStats();
            }
        }

        function getModuleFromAction(action) {
            if (action.includes('LOGIN') || action.includes('AUTH')) return 'auth';
            if (action.includes('VOTE')) return 'voting';
            if (action.includes('CANDIDATE')) return 'candidate';
            if (action.includes('ADMIN')) return 'admin';
            return 'system';
        }

        // ===== FILTERING =====
        function filterLogs() {
            const searchTerm = document.getElementById('logSearch').value.toLowerCase();
            const levelFilter = document.getElementById('logLevel').value;
            const userFilter = document.getElementById('logUser').value;
            const moduleFilter = document.getElementById('logModule').value;
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            
            filteredLogs = allLogs.filter(log => {
                // Search term filter
                if (searchTerm) {
                    const searchableText = [
                        log.action || '',
                        log.details || '',
                        log.user_name || '',
                        log.ip_address || ''
                    ].join(' ').toLowerCase();
                    
                    if (!searchableText.includes(searchTerm)) {
                        return false;
                    }
                }
                
                // Level filter
                if (levelFilter) {
                    let logLevel = 'info';
                    
                    if (log.action.includes('ERROR')) logLevel = 'error';
                    else if (log.action.includes('WARNING')) logLevel = 'warning';
                    else if (log.action.includes('SUCCESS') || log.action.includes('VOTE_CAST')) logLevel = 'success';
                    else if (log.action.includes('LOGIN') || log.action.includes('SECURITY')) logLevel = 'security';
                    
                    if (logLevel !== levelFilter) {
                        return false;
                    }
                }
                
                // User filter
                if (userFilter && log.user_name !== userFilter) {
                    return false;
                }
                
                // Module filter
                if (moduleFilter) {
                    const logModule = getModuleFromAction(log.action);
                    if (logModule !== moduleFilter) {
                        return false;
                    }
                }
                
                // Date filter
                if (startDate) {
                    const logDate = new Date(log.timestamp).toISOString().slice(0, 10);
                    if (logDate < startDate) {
                        return false;
                    }
                }
                
                if (endDate) {
                    const logDate = new Date(log.timestamp).toISOString().slice(0, 10);
                    if (logDate > endDate) {
                        return false;
                    }
                }
                
                return true;
            });
            
            // Reset to first page
            currentPage = 1;
            
            // Render filtered logs
            renderLogsTable();
            renderPagination();
        }

        function resetFilters() {
            document.getElementById('logSearch').value = '';
            document.getElementById('logLevel').value = '';
            document.getElementById('logUser').value = '';
            document.getElementById('logModule').value = '';
            
            setDefaultDates();
            
            filterLogs();
            
            showNotification('Filter', 'Semua filter telah direset', 'info');
        }

        function updateUserFilterOptions(logs) {
            const userSelect = document.getElementById('logUser');
            const currentValue = userSelect.value;
            
            const users = [...new Set(logs.map(log => log.user_name))].filter(Boolean).sort();
            
            userSelect.innerHTML = '<option value="">Semua Pengguna</option>';
            users.forEach(user => {
                const option = document.createElement('option');
                option.value = user;
                option.textContent = user;
                userSelect.appendChild(option);
            });
            
            if (currentValue && users.includes(currentValue)) {
                userSelect.value = currentValue;
            }
        }

        // ===== RENDERING =====
        function renderLogsTable() {
            const tableBody = document.getElementById('logsTableBody');
            
            if (filteredLogs.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="7">
                            <div class="empty-state">
                                <i class="fas fa-clipboard-list"></i>
                                <h3>Tidak ada log yang ditemukan</h3>
                                <p>Coba ubah filter pencarian Anda</p>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }
            
            const startIndex = (currentPage - 1) * logsPerPage;
            const endIndex = startIndex + logsPerPage;
            const pageLogs = filteredLogs.slice(startIndex, endIndex);
            
            let tableHTML = '';
            
            pageLogs.forEach(log => {
                const date = new Date(log.timestamp);
                const timeString = date.toLocaleTimeString('id-ID');
                const dateString = date.toLocaleDateString('id-ID');
                
                let level = 'info';
                let levelClass = 'level-info';
                
                if (log.action.includes('ERROR')) {
                    level = 'error';
                    levelClass = 'level-error';
                } else if (log.action.includes('WARNING')) {
                    level = 'warning';
                    levelClass = 'level-warning';
                } else if (log.action.includes('SUCCESS') || log.action.includes('VOTE_CAST')) {
                    level = 'success';
                    levelClass = 'level-success';
                } else if (log.action.includes('LOGIN') || log.action.includes('SECURITY')) {
                    level = 'security';
                    levelClass = 'level-security';
                }
                
                const module = getModuleFromAction(log.action);
                
                let message = log.details || log.action;
                if (message.length > 100) {
                    message = message.substring(0, 100) + '...';
                }
                
                const isNew = (Date.now() - new Date(log.timestamp).getTime()) < 5 * 60 * 1000;
                
                tableHTML += `
                    <tr ${isNew ? 'style="background-color: #f0f9ff;"' : ''}>
                        <td>
                            <div>${dateString}</div>
                            <div class="log-details">${timeString} ${isNew ? 'ðŸ†•' : ''}</div>
                        </td>
                        <td><span class="log-level ${levelClass}">${level}</span></td>
                        <td>
                            <div class="log-user">
                                <div class="user-avatar">
                                    ${log.user_name ? log.user_name.charAt(0).toUpperCase() : 'S'}
                                </div>
                                <div>
                                    <div>${log.user_name || 'System'}</div>
                                    <div class="log-details">${log.user_id || 'system'}</div>
                                </div>
                            </div>
                        </td>
                        <td class="log-message" title="${log.details || log.action}">${message}</td>
                        <td><span class="log-level level-info">${module}</span></td>
                        <td><span class="log-ip">${log.ip_address || 'localhost'}</span></td>
                        <td>
                            <div class="log-actions">
                                <button onclick="viewLogDetail('${log.id}')" title="Lihat Detail">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button onclick="copyLog('${log.id}')" title="Salin Log">
                                    <i class="fas fa-copy"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = tableHTML;
        }

        function renderPagination() {
            const totalPages = Math.ceil(filteredLogs.length / logsPerPage);
            const pagination = document.getElementById('logsPagination');
            
            if (totalPages <= 1) {
                pagination.innerHTML = '';
                return;
            }
            
            let paginationHTML = '';
            
            // Previous button
            paginationHTML += `
                <li class="page-item ${currentPage === 1 ? 'disabled' : ''}">
                    <a class="page-link" href="#" onclick="changePage(${currentPage - 1}); return false;">
                        <i class="fas fa-chevron-left"></i>
                    </a>
                </li>
            `;
            
            // Page numbers
            const maxPagesToShow = 5;
            let startPage = Math.max(1, currentPage - Math.floor(maxPagesToShow / 2));
            let endPage = Math.min(totalPages, startPage + maxPagesToShow - 1);
            
            if (endPage - startPage + 1 < maxPagesToShow) {
                startPage = Math.max(1, endPage - maxPagesToShow + 1);
            }
            
            for (let i = startPage; i <= endPage; i++) {
                paginationHTML += `
                    <li class="page-item ${currentPage === i ? 'active' : ''}">
                        <a class="page-link" href="#" onclick="changePage(${i}); return false;">${i}</a>
                    </li>
                `;
            }
            
            // Next button
            paginationHTML += `
                <li class="page-item ${currentPage === totalPages ? 'disabled' : ''}">
                    <a class="page-link" href="#" onclick="changePage(${currentPage + 1}); return false;">
                        <i class="fas fa-chevron-right"></i>
                    </a>
                </li>
            `;
            
            pagination.innerHTML = paginationHTML;
        }

        function changePage(page) {
            const totalPages = Math.ceil(filteredLogs.length / logsPerPage);
            
            if (page < 1 || page > totalPages) return;
            
            currentPage = page;
            renderLogsTable();
            renderPagination();
            
            const tableContainer = document.querySelector('.voters-table-container');
            if (tableContainer) {
                tableContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }

        // ===== STATISTICS =====
        function updateLogStats() {
            const totalLogs = allLogs.length;
            
            const infoLogs = allLogs.filter(log => 
                !log.action.includes('ERROR') && 
                !log.action.includes('WARNING') &&
                !log.action.includes('SUCCESS') &&
                !log.action.includes('VOTE_CAST') &&
                !log.action.includes('LOGIN') &&
                !log.action.includes('SECURITY')
            ).length;
            
            const warningLogs = allLogs.filter(log => log.action.includes('WARNING')).length;
            const errorLogs = allLogs.filter(log => log.action.includes('ERROR')).length;
            const successLogs = allLogs.filter(log => 
                log.action.includes('SUCCESS') || 
                log.action.includes('VOTE_CAST')
            ).length;
            
            const securityLogs = allLogs.filter(log => 
                log.action.includes('LOGIN') || 
                log.action.includes('LOGOUT') ||
                log.action.includes('SECURITY')
            ).length;
            
            const today = new Date().toDateString();
            const todayLogs = allLogs.filter(log => 
                new Date(log.timestamp).toDateString() === today
            ).length;
            
            document.getElementById('logStats').innerHTML = `
                <div class="stat-card">
                    <div class="icon">
                        <i class="fas fa-history"></i>
                    </div>
                    <div class="value">${totalLogs.toLocaleString()}</div>
                    <div class="label">Total Log</div>
                </div>
                <div class="stat-card">
                    <div class="icon">
                        <i class="fas fa-calendar-day"></i>
                    </div>
                    <div class="value">${todayLogs.toLocaleString()}</div>
                    <div class="label">Hari Ini</div>
                </div>
                <div class="stat-card">
                    <div class="icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="value">${successLogs.toLocaleString()}</div>
                    <div class="label">Berhasil</div>
                </div>
                <div class="stat-card">
                    <div class="icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="value">${warningLogs.toLocaleString()}</div>
                    <div class="label">Peringatan</div>
                </div>
                <div class="stat-card">
                    <div class="icon">
                        <i class="fas fa-times-circle"></i>
                    </div>
                    <div class="value">${errorLogs.toLocaleString()}</div>
                    <div class="label">Error</div>
                </div>
            `;
        }

        // ===== LOG DETAILS =====
        async function viewLogDetail(logId) {
            try {
                const log = allLogs.find(l => l.id === logId);
                
                if (!log) {
                    showNotification('Error', 'Log tidak ditemukan', 'error');
                    return;
                }
                
                const detailContent = document.getElementById('logDetailContent');
                const date = new Date(log.timestamp);
                
                let level = 'info';
                let levelClass = 'level-info';
                
                if (log.action.includes('ERROR')) {
                    level = 'error';
                    levelClass = 'level-error';
                } else if (log.action.includes('WARNING')) {
                    level = 'warning';
                    levelClass = 'level-warning';
                } else if (log.action.includes('SUCCESS') || log.action.includes('VOTE_CAST')) {
                    level = 'success';
                    levelClass = 'level-success';
                } else if (log.action.includes('LOGIN') || log.action.includes('SECURITY')) {
                    level = 'security';
                    levelClass = 'level-security';
                }
                
                detailContent.innerHTML = `
                    <div class="detail-item">
                        <div class="detail-label">Timestamp</div>
                        <div class="detail-value">${date.toLocaleString('id-ID')}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Action</div>
                        <div class="detail-value">${log.action}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Level</div>
                        <div class="detail-value">
                            <span class="log-level ${levelClass}">${level.toUpperCase()}</span>
                        </div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Pengguna</div>
                        <div class="detail-value">${log.user_name || 'System'} (${log.user_id || 'system'})</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Detail</div>
                        <div class="detail-value">${log.details || 'Tidak ada detail tambahan'}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">IP Address</div>
                        <div class="detail-value">${log.ip_address || 'localhost'}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Data Lengkap</div>
                        <div class="detail-value" style="background: #f5f5f5; padding: 10px; border-radius: 5px; font-family: monospace; font-size: 12px;">
                            ${JSON.stringify(log, null, 2)}
                        </div>
                    </div>
                `;
                
                document.getElementById('logDetailModal').style.display = 'flex';
                
            } catch (error) {
                console.error('Error viewing log detail:', error);
                showNotification('Error', 'Gagal memuat detail log', 'error');
            }
        }

        function closeLogDetailModal() {
            document.getElementById('logDetailModal').style.display = 'none';
        }

        // ===== UTILITIES =====
        async function copyLog(logId) {
            try {
                const log = allLogs.find(l => l.id === logId);
                
                if (!log) {
                    showNotification('Error', 'Log tidak ditemukan', 'error');
                    return;
                }
                
                const logText = `[${new Date(log.timestamp).toLocaleString()}] [${log.action}] ${log.user_name || 'System'}: ${log.details || ''} (IP: ${log.ip_address || 'localhost'})`;
                
                await navigator.clipboard.writeText(logText);
                
                showNotification('Berhasil', 'Log berhasil disalin ke clipboard', 'success');
                
            } catch (error) {
                console.error('Error copying log:', error);
                showNotification('Error', 'Gagal menyalin log', 'error');
            }
        }

        async function clearOldLogs() {
            if (!confirm('Hapus log yang berusia lebih dari 30 hari?\n\nAksi ini tidak dapat dibatalkan.')) {
                return;
            }
            
            try {
                showNotification('Memproses', 'Menghapus log lama...', 'info');
                
                // Calculate date 30 days ago
                const thirtyDaysAgo = new Date();
                thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
                
                // Filter logs older than 30 days
                const logsToDelete = allLogs.filter(log => 
                    new Date(log.timestamp) < thirtyDaysAgo
                );
                
                // Call database delete function if available
                let deletedCount = logsToDelete.length;
                if (window.db && window.db.deleteOldLogs) {
                    const result = await window.db.deleteOldLogs(30);
                    deletedCount = result.deletedCount || deletedCount;
                }
                
                // Add audit log
                if (window.db && window.db.addAuditLog) {
                    await window.db.addAuditLog({
                        action: 'LOGS_CLEARED',
                        user_id: sessionStorage.getItem('adminUsername') || 'admin',
                        user_name: sessionStorage.getItem('adminName') || 'Admin',
                        details: `Menghapus ${deletedCount} log yang berusia lebih dari 30 hari`,
                        ip_address: 'localhost'
                    });
                }
                
                // Refresh logs
                await refreshLogs();
                
                showNotification('Berhasil', `${deletedCount} log lama berhasil dihapus`, 'success');
                
            } catch (error) {
                console.error('Error clearing old logs:', error);
                showNotification('Error', 'Gagal menghapus log lama: ' + error.message, 'error');
            }
        }

        async function exportLogs() {
            try {
                if (filteredLogs.length === 0) {
                    showNotification('Peringatan', 'Tidak ada data untuk diekspor', 'warning');
                    return;
                }
                
                // Create export options dialog
                const exportDialog = `
                    <div style="padding: 20px;">
                        <h3 style="margin-bottom: 15px;"><i class="fas fa-file-export"></i> Ekspor Log OSSIP</h3>
                        <p style="margin-bottom: 15px;">Pilih format ekspor:</p>
                        <div style="display: flex; flex-direction: column; gap: 10px;">
                            <button onclick="exportAsCSV()" style="padding: 12px; background: var(--primary-color); color: white; border: none; border-radius: 6px; cursor: pointer; display: flex; align-items: center; gap: 10px;">
                                <i class="fas fa-file-csv"></i> CSV (Excel)
                            </button>
                            <button onclick="exportAsJSON()" style="padding: 12px; background: var(--info-color); color: white; border: none; border-radius: 6px; cursor: pointer; display: flex; align-items: center; gap: 10px;">
                                <i class="fas fa-file-code"></i> JSON
                            </button>
                            <button onclick="exportAsText()" style="padding: 12px; background: var(--gray-color); color: white; border: none; border-radius: 6px; cursor: pointer; display: flex; align-items: center; gap: 10px;">
                                <i class="fas fa-file-alt"></i> Text
                            </button>
                        </div>
                    </div>
                `;
                
                // Show custom dialog
                const dialog = document.createElement('div');
                dialog.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0,0,0,0.5);
                    z-index: 2000;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                `;
                dialog.innerHTML = `
                    <div style="background: white; border-radius: 10px; width: 90%; max-width: 400px; box-shadow: 0 10px 30px rgba(0,0,0,0.2);">
                        ${exportDialog}
                        <div style="padding: 15px; text-align: right; border-top: 1px solid #eee;">
                            <button onclick="this.closest('div[style*=\"position: fixed\"]').remove()" style="padding: 8px 20px; background: #f5f5f5; border: 1px solid #ddd; border-radius: 4px; cursor: pointer;">
                                Batal
                            </button>
                        </div>
                    </div>
                `;
                document.body.appendChild(dialog);
                
                // Define export functions
                window.exportAsCSV = async function() {
                    dialog.remove();
                    await performExport('csv');
                };
                
                window.exportAsJSON = async function() {
                    dialog.remove();
                    await performExport('json');
                };
                
                window.exportAsText = async function() {
                    dialog.remove();
                    await performExport('text');
                };
                
            } catch (error) {
                console.error('Error showing export dialog:', error);
                showNotification('Error', 'Gagal menampilkan dialog ekspor', 'error');
            }
        }

        async function performExport(format) {
            try {
                showNotification('Memproses', 'Menyiapkan ekspor...', 'info');
                
                let exportData;
                let filename;
                let mimeType;
                
                switch(format) {
                    case 'csv':
                        exportData = convertLogsToCSV(filteredLogs);
                        filename = `ossip_logs_${new Date().toISOString().slice(0, 10)}.csv`;
                        mimeType = 'text/csv';
                        break;
                        
                    case 'json':
                        exportData = JSON.stringify(filteredLogs, null, 2);
                        filename = `ossip_logs_${new Date().toISOString().slice(0, 10)}.json`;
                        mimeType = 'application/json';
                        break;
                        
                    case 'text':
                        exportData = convertLogsToText(filteredLogs);
                        filename = `ossip_logs_${new Date().toISOString().slice(0, 10)}.txt`;
                        mimeType = 'text/plain';
                        break;
                }
                
                // Create download link
                const blob = new Blob([exportData], { type: mimeType });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                // Add audit log
                if (window.db && window.db.addAuditLog) {
                    await window.db.addAuditLog({
                        action: 'LOGS_EXPORTED',
                        user_id: sessionStorage.getItem('adminUsername') || 'admin',
                        user_name: sessionStorage.getItem('adminName') || 'Admin',
                        details: `Mengekspor ${filteredLogs.length} log dalam format ${format.toUpperCase()}`,
                        ip_address: 'localhost'
                    });
                }
                
                showNotification('Berhasil', `Log berhasil diekspor (${filename})`, 'success');
                
            } catch (error) {
                console.error('Error exporting logs:', error);
                showNotification('Error', 'Gagal mengekspor log: ' + error.message, 'error');
            }
        }

        function convertLogsToCSV(logs) {
            const headers = ['Timestamp', 'Action', 'Level', 'User ID', 'User Name', 'Details', 'IP Address'];
            const rows = logs.map(log => {
                let level = 'info';
                if (log.action.includes('ERROR')) level = 'error';
                else if (log.action.includes('WARNING')) level = 'warning';
                else if (log.action.includes('SUCCESS') || log.action.includes('VOTE_CAST')) level = 'success';
                else if (log.action.includes('LOGIN') || log.action.includes('SECURITY')) level = 'security';
                
                return [
                    new Date(log.timestamp).toISOString(),
                    log.action,
                    level,
                    log.user_id || 'system',
                    log.user_name || 'System',
                    `"${(log.details || '').replace(/"/g, '""')}"`,
                    log.ip_address || 'localhost'
                ];
            });
            
            return [headers, ...rows].map(row => row.join(',')).join('\n');
        }

        function convertLogsToText(logs) {
            return logs.map(log => {
                const date = new Date(log.timestamp);
                return `[${date.toLocaleString('id-ID')}] [${log.action}] ${log.user_name || 'System'}: ${log.details || ''}`;
            }).join('\n');
        }

        function showNotification(title, message, type = 'info') {
            const container = document.getElementById('notificationContainer');
            
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            let icon = 'fas fa-info-circle';
            switch(type) {
                case 'success': icon = 'fas fa-check-circle'; break;
                case 'warning': icon = 'fas fa-exclamation-triangle'; break;
                case 'error': icon = 'fas fa-times-circle'; break;
                case 'info': icon = 'fas fa-info-circle'; break;
            }
            
            notification.innerHTML = `
                <div class="notification-icon">
                    <i class="${icon}"></i>
                </div>
                <div class="notification-info">
                    <div class="notification-title">${title}</div>
                    <div class="notification-message">${message}</div>
                </div>
                <button class="notification-close" onclick="this.parentElement.remove()">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            container.appendChild(notification);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.style.animation = 'slideOutRight 0.3s ease';
                    setTimeout(() => notification.remove(), 300);
                }
            }, 5000);
        }

        function logout() {
            if (confirm('Apakah Anda yakin ingin logout?')) {
                // Add logout audit log
                if (window.db && window.db.addAuditLog) {
                    window.db.addAuditLog({
                        action: 'ADMIN_LOGOUT',
                        user_id: sessionStorage.getItem('adminUsername') || 'admin',
                        user_name: sessionStorage.getItem('adminName') || 'Admin',
                        details: 'Admin logout dari sistem logs',
                        ip_address: 'localhost'
                    });
                }
                
                // Clear session
                sessionStorage.clear();
                
                // Redirect to login
                window.location.href = 'admin-login.html';
            }
        }

        // ===== EVENT LISTENERS =====
        window.onclick = function(event) {
            const modal = document.getElementById('logDetailModal');
            if (event.target === modal) {
                closeLogDetailModal();
            }
        }

        window.addEventListener('beforeunload', () => {
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
            }
            if (refreshInterval) {
                clearInterval(refreshInterval);
            }
        });

        // ===== TEST FUNCTIONS =====
        function simulateTestLog() {
            const testLog = {
                id: 'test_' + Date.now(),
                timestamp: new Date().toISOString(),
                action: 'TEST_LOG',
                user_id: 'test',
                user_name: 'Test User',
                details: 'Ini adalah log uji coba sistem',
                ip_address: '192.168.1.99'
            };
            
            addLogToDisplay(testLog, true);
            updateLogStats();
            showNotification('Log Uji', 'Log uji coba berhasil ditambahkan', 'success');
        }

        console.log('ðŸŒŸ Sistem Log Admin siap digunakan!');
    </script>
</body>
</html>